{"ast":null,"code":"import _classCallCheck from \"/Users/oscargonzalez/Documents/GitHub/front-end-MH-new/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/oscargonzalez/Documents/GitHub/front-end-MH-new/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport { MembershipService } from 'app/services/membership/membership.service';\nimport { DatePipe } from '@angular/common';\nimport * as alertify from 'alertify.js';\nimport { ExporterService } from 'app/services/export-excel/exporter.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"app/services/membership/membership.service\";\nimport * as i2 from \"app/services/export-excel/exporter.service\";\nimport * as i3 from \"@angular/material/button\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/material/checkbox\";\nimport * as i6 from \"@angular/material/dialog\";\n\nfunction ListUserAttendanceComponent_div_17_tr_21_Template(rf, ctx) {\n  if (rf & 1) {\n    var _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\")(4, \"p\");\n    i0.ɵɵelement(5, \"mat-checkbox\", 19);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"td\")(7, \"p\");\n    i0.ɵɵelement(8, \"mat-checkbox\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(9, \"td\")(10, \"p\");\n    i0.ɵɵelement(11, \"mat-checkbox\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(12, \"td\")(13, \"p\");\n    i0.ɵɵelement(14, \"mat-checkbox\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(15, \"td\")(16, \"p\");\n    i0.ɵɵelement(17, \"mat-checkbox\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(18, \"td\")(19, \"p\");\n    i0.ɵɵelement(20, \"mat-checkbox\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(21, \"td\")(22, \"p\");\n    i0.ɵɵelement(23, \"mat-checkbox\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(24, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function ListUserAttendanceComponent_div_17_tr_21_Template_button_click_24_listener() {\n      var restoredCtx = i0.ɵɵrestoreView(_r5);\n      var item_r3 = restoredCtx.$implicit;\n      var ctx_r4 = i0.ɵɵnextContext(2);\n      return ctx_r4.attendanceUser(item_r3._id, item_r3.asistencia);\n    });\n    i0.ɵɵtext(25, \"Generar Asistencia\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    var item_r3 = ctx.$implicit;\n    var ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" \", item_r3.nombre, \" \", item_r3.apellido, \" \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"checked\", ctx_r1.indeterminate);\n    i0.ɵɵadvance(19);\n    i0.ɵɵproperty(\"mat-dialog-close\", true);\n  }\n}\n\nfunction ListUserAttendanceComponent_div_17_div_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 21);\n    i0.ɵɵtext(1, \" SIN USUARIOS \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ListUserAttendanceComponent_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13)(1, \"div\", 14)(2, \"table\", 15)(3, \"thead\", 16)(4, \"th\");\n    i0.ɵɵtext(5, \" Nombres y Apellidos \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \" Lunes \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \" Martes \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \" Miercoles \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"th\");\n    i0.ɵɵtext(13, \" Jueves \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"th\");\n    i0.ɵɵtext(15, \" Viernes \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"th\");\n    i0.ɵɵtext(17, \" Sabado \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"th\");\n    i0.ɵɵtext(19, \" Domingo \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(20, \"tbody\");\n    i0.ɵɵtemplate(21, ListUserAttendanceComponent_div_17_tr_21_Template, 26, 4, \"tr\", 17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(22, ListUserAttendanceComponent_div_17_div_22_Template, 2, 0, \"div\", 18);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    var ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(21);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.dataUserSystem);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.dataUserSystem.length === 0);\n  }\n}\n\nexport var ListUserAttendanceComponent = /*#__PURE__*/(function () {\n  var ListUserAttendanceComponent = /*#__PURE__*/function () {\n    function ListUserAttendanceComponent(user_data, exportService) {\n      _classCallCheck(this, ListUserAttendanceComponent);\n\n      this.user_data = user_data;\n      this.exportService = exportService;\n      this.today = new Date();\n      this.pipe = new DatePipe('en-US');\n      this.todayWithPipe = null;\n      this.Fecha = this.pipe.transform(Date.now(), 'dd/MM/yyyy');\n      this.dataUserSystem = [];\n      this.asistenciaUser = [];\n      this.listUserCentroTrabajo = [];\n      this.listExcel = [];\n      this.disabled = true;\n    }\n\n    _createClass(ListUserAttendanceComponent, [{\n      key: \"ngOnInit\",\n      value: function ngOnInit() {\n        var _this = this;\n\n        this.dataUser = JSON.parse(localStorage.getItem('infoUser'));\n        this.user_data.getMembership().subscribe(function (data) {\n          _this.dataUserSystem = data;\n\n          if (_this.dataUser.roles === \"Super Admin\") {\n            _this.dataUserSystem = data;\n          } else {\n            for (var index = 0; index < _this.dataUserSystem.length; index++) {\n              var elementInfo = _this.dataUserSystem[index];\n              var element = _this.dataUserSystem[index].proyectos;\n\n              if (element === _this.dataUser.proyectos) {\n                _this.listUserCentroTrabajo.push(elementInfo);\n              }\n            }\n\n            _this.dataUserSystem = _this.listUserCentroTrabajo;\n          }\n        });\n      }\n    }, {\n      key: \"attendanceUser\",\n      value: function attendanceUser(id, asistenciasUser) {\n        this.asistenciaUser.push(this.dataUserSystem[0].asistencia);\n        var asist = this.asistenciaUser[0];\n        var prueba = {\n          \"fecha\": this.Fecha,\n          \"asistencia\": \"Si\"\n        };\n        asist.push(prueba);\n        var attendenceUser = {\n          asistencia: asist\n        };\n        this.user_data.putAttendanceUser(id, attendenceUser).subscribe(function (data) {\n          console.log(data); // alertify.success('Asistencia generada con exito.');\n\n          alertify.alert('Asistencia generada con exito.', function () {\n            alertify.error('Ok');\n          });\n        });\n      }\n    }, {\n      key: \"exportAsXLSX\",\n      value: function exportAsXLSX() {\n        this.exportService.exportToExcel(this.dataUserSystem, 'info_afiliados');\n      }\n    }, {\n      key: \"generateNomina\",\n      value: function generateNomina() {\n        var DiasLaborados = 15;\n        var valorSubsidio = 117.172;\n        var HoraExtraDiurna = 0.25;\n        var TrabajoNocturno = 0.35;\n\n        for (var index = 0; index < this.dataUserSystem.length; index++) {\n          // const element = this.dataUserSystem[index];\n          var SalarioDebengado = this.dataUserSystem[index].salario / 30 * DiasLaborados;\n          var subsidioTransporte = Number(valorSubsidio) / 30 * DiasLaborados;\n          var DescuentoPension = Number(SalarioDebengado) * 0.04;\n          var DescuentoSalud = Number(SalarioDebengado) * 0.04;\n          console.log(\"SalarioDebengado\", Number(SalarioDebengado));\n          console.log(\"subsidioTransporte\", Number(subsidioTransporte));\n          console.log(\"DescuentoPension\", Number(DescuentoPension));\n          console.log(\"DescuentoSalud\", Number(DescuentoSalud));\n          var SubTotal = Number(SalarioDebengado) + 58586;\n          console.log(\"SubTotal\", Math.round(SubTotal));\n          var Descuentos = Number(DescuentoSalud) + Number(DescuentoPension);\n          console.log(\"Descuentos\", Number(Descuentos));\n          var TotalSalario = Number(SubTotal) - Number(Descuentos);\n          console.log(\"SALARIO\", Number(TotalSalario));\n          var objetcListExcelNomina = {\n            \"Nombre y Apellidos\": this.dataUserSystem[index].nombre + this.dataUserSystem[index].apellido,\n            \"Cedula\": this.dataUserSystem[index].cedula,\n            \"Cargo\": this.dataUserSystem[index].cargo,\n            \"Salario\": Number(this.dataUserSystem[index].salario),\n            \"Dias Laborados\": Number(DiasLaborados),\n            \"Salario Debengao\": Number(SalarioDebengado),\n            \"Subsidio Transporte\": Number(subsidioTransporte),\n            \"Descuento Pension\": Number(DescuentoPension),\n            \"Descuento Salud\": Number(DescuentoSalud),\n            \"Total Salario\": Number(TotalSalario)\n          };\n          this.listExcel.push(objetcListExcelNomina); // alertify.alert(`Nomina de ${user[index].nombre} ${user.apellido} generada con exito. Valor a PAGAR : $ ${TotalSalario}`, function () { alertify.error('Ok'); });\n          // console.log(`Nomina de ${this.dataUserSystem[index].nombre} ${this.dataUserSystem[index].apellido} generada con exito. Valor a PAGAR : $ ${TotalSalario}`);\n        }\n\n        console.log(\"Nomina -------\", this.listExcel);\n        this.exportService.exportToExcel(this.listExcel, \"Nomina del mes \");\n      }\n    }]);\n\n    return ListUserAttendanceComponent;\n  }();\n\n  ListUserAttendanceComponent.ɵfac = function ListUserAttendanceComponent_Factory(t) {\n    return new (t || ListUserAttendanceComponent)(i0.ɵɵdirectiveInject(i1.MembershipService), i0.ɵɵdirectiveInject(i2.ExporterService));\n  };\n\n  ListUserAttendanceComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ListUserAttendanceComponent,\n    selectors: [[\"app-list-user-attendance\"]],\n    decls: 18,\n    vars: 2,\n    consts: [[1, \"main-content\"], [1, \"container-fluid\"], [1, \"row\"], [1, \"col-md-12\"], [1, \"card\"], [1, \"card-header\", \"card-header-danger\"], [1, \"col-md-8\"], [1, \"card-title\"], [1, \"card-category\"], [1, \"col-md-4\"], [\"mat-raised-button\", \"\", 3, \"click\"], [1, \"material-icons\"], [\"class\", \"card-body\", 4, \"ngIf\"], [1, \"card-body\"], [1, \"table-responsive\"], [1, \"table\"], [1, \"text-primary\"], [4, \"ngFor\", \"ngForOf\"], [\"style\", \"margin-left: auto; margin-right: auto; text-align: center;\", \"class\", \"alert alert-info\", \"role\", \"alert\", 4, \"ngIf\"], [3, \"checked\"], [\"type\", \"submit\", \"mat-raised-button\", \"\", \"color\", \"warn\", 3, \"mat-dialog-close\", \"click\"], [\"role\", \"alert\", 1, \"alert\", \"alert-info\", 2, \"margin-left\", \"auto\", \"margin-right\", \"auto\", \"text-align\", \"center\"]],\n    template: function ListUserAttendanceComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"div\", 4)(5, \"div\", 5)(6, \"div\", 2)(7, \"div\", 6)(8, \"h3\", 7);\n        i0.ɵɵtext(9);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"p\", 8);\n        i0.ɵɵtext(11, \" Lista de usuarios para asistecia del sistema\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(12, \"div\", 9)(13, \"button\", 10);\n        i0.ɵɵlistener(\"click\", function ListUserAttendanceComponent_Template_button_click_13_listener() {\n          return ctx.generateNomina();\n        });\n        i0.ɵɵelementStart(14, \"i\", 11);\n        i0.ɵɵtext(15, \"file_download\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(16, \" GENERAR NOMINA\");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵtemplate(17, ListUserAttendanceComponent_div_17_Template, 23, 2, \"div\", 12);\n        i0.ɵɵelementEnd()()()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(9);\n        i0.ɵɵtextInterpolate1(\"Lista de Asistencias (FECHA \", ctx.Fecha, \" )\");\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"ngIf\", ctx.disabled);\n      }\n    },\n    directives: [i3.MatButton, i4.NgIf, i4.NgForOf, i5.MatCheckbox, i6.MatDialogClose],\n    styles: [\"\"]\n  });\n  return ListUserAttendanceComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}